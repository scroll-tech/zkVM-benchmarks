#!/bin/bash
set -euxo pipefail
export N=$((1<<14))
output="output_time"

(
  cd sorting/program
  cargo prove build
)
(
  cd sorting/script

  export RUSTFLAGS="-C target-cpu=native -C target-feature=+avx512f"
  # export RUSTFLAGS="-C target-cpu=native"
  export RUST_LOG=info
  # cargo clean
  cargo build --release --bin sorting
  /usr/bin/time --verbose --output="${output}" -- cargo run --release -- --n=$N --prove
  echo "RUSTFLAGS=\'${RUSTFLAGS:-}\'"
  echo "N=\'${N}'"
  cat "${output}"
)
